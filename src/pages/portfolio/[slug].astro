---
import { Image } from 'astro:assets'
import BaseLayout from '../../layouts/BaseLayout.astro'
import { getCollection } from 'astro:content'
import { render } from 'astro:content'
import BgImg from '../../images/bg.png'
import ProjectMedia from '../../components/ProjectMedia.astro'
import ProjectCodeAccess from '../../components/ProjectCodeAccess.astro'
import ExternalLinkIcon from '../../components/ExternalLinkIcon.astro'

export async function getStaticPaths() {
  const entries = await getCollection('projects')
  return entries.map((entry) => ({ params: { slug: entry.slug } }))
}

const { slug } = Astro.params
const entries = await getCollection('projects')
const entry = entries.find((e) => e.slug === slug)
if (!entry) {
  throw new Error('Project not found')
}

const { Content } = await render(entry)
---

<BaseLayout title={entry.data.title} description={entry.data.summary}>
  <div class="relative min-h-[calc(100vh-200px)]">
    <div class="absolute inset-0">
      <Image
        class="h-full w-full object-cover object-top"
        src={BgImg}
        alt=""
      />
      <div aria-hidden="true" class="absolute inset-0 bg-black/70"></div>
    </div>

    <article class="relative mx-auto max-w-7xl px-4 py-10 sm:px-6">
      <div class="mx-auto max-w-7xl">
      <a class="text-sm text-slate-300 hover:text-white" href="/portfolio">
        Back to portfolio
      </a>
      <h1 class="mt-4 text-3xl font-semibold tracking-tight text-white sm:text-4xl">
        {entry.data.title}
      </h1>
      <p class="mt-2 text-slate-300">
        <span class="font-semibold text-white">{entry.data.client}</span>
        <span class="mx-2 text-white/20">|</span>
        <span>{entry.data.role}</span>
        <span class="mx-2 text-white/20">|</span>
        <span>{entry.data.dateRange}</span>
      </p>

      <!-- {entry.data.nda ? (
        <div class="mt-6 rounded-lg border border-brown-700/40 bg-brown-900/20 p-4 text-sm text-brown-100">
          This project write-up is NDA-safe. Any screenshots or recordings are redacted to remove customer data and internal URLs.
        </div>
      ) : null} -->

      {entry.data.links.length > 0 ? (
        <div class="mt-6 flex flex-wrap gap-3">
          {entry.data.links.map((l) => (
            <a
              class="rounded-md bg-white/10 px-4 py-2 text-sm font-semibold text-white hover:bg-white/15"
              href={l.href}
              target="_blank"
              rel="noopener noreferrer"
              aria-label={`${l.label} (opens in a new tab)`}
            >
              {l.label}
              <ExternalLinkIcon class="h-4 w-4 inline-block ml-1" />
            </a>
          ))}
        </div>
      ) : null}

      <ProjectMedia media={entry.data.media} nda={entry.data.nda} />

      <!-- {entry.data.codeAccess ? (
        <ProjectCodeAccess codeAccess={entry.data.codeAccess} projectSlug={entry.slug} />
      ) : null} -->

      <div class="prose prose-invert mt-10 max-w-none prose-headings:tracking-tight prose-a:text-brown-300">
        <Content />
      </div>

      <!-- <section class="mt-12 grid gap-8 sm:grid-cols-2">
        <div class="rounded-xl border border-white/10 bg-white/5 p-6">
          <h2 class="text-base font-semibold text-white">Highlights</h2>
          <ul class="mt-4 list-disc space-y-2 pl-5 text-sm text-slate-300">
            {entry.data.highlights.map((h) => (
              <li>{h}</li>
            ))}
          </ul>
        </div>
        <div class="rounded-xl border border-white/10 bg-white/5 p-6">
          <h2 class="text-base font-semibold text-white">Outcomes</h2>
          <ul class="mt-4 list-disc space-y-2 pl-5 text-sm text-slate-300">
            {entry.data.outcomes.map((o) => (
              <li>{o}</li>
            ))}
          </ul>
        </div>
      </section> -->
      </div>
    </article>
  </div>
</BaseLayout>
